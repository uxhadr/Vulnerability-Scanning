# Vulnerability Scanning with Nessus on Azure VM

In this project, I conducted a vulnerability assessment on a Windows 10 virtual machine (VM) deployed on Azure using Nessus. The goal was to identify and remediate high-severity vulnerabilities to enhance the security posture of the VM. Below, I outline the steps I took to perform the scan, configure the VM, and remediate a specific high-severity vulnerability.

### Steps to Complete the Project

1. **Download and Install Nessus**
   - Downloaded Tenable Nessus for Mac from the official Nessus website.
   - Registered for Nessus Essentials using an activation code.

   ![Nessus Registration](https://github.com/user-attachments/assets/fda5f1e1-83fd-48cb-934d-4da400b789f2)
   
2. **Initial Vulnerability Scan**
   - Set up a basic vulnerability scan in Nessus targeting the Azure VM using its public IP address.
   ![Nessus Scan Configuration](https://github.com/user-attachments/assets/14e9c9f7-b2c8-465e-8294-930dcc185697)
   - Reviewed the scan results to identify existing vulnerabilities.
   <img width="1314" alt="image" src="https://github.com/user-attachments/assets/b2906c0f-4d1e-48b0-8373-290eab47bd3e">

3. **Prepare VM for Credentialed Scanning**
   - Used Remote Desktop Protocol (RDP) to access the Windows 10 Azure VM.
   - Enabled Remote Registry and File and Printer Sharing to allow Nessus to access necessary system configurations.

   ![Remote Registry and Sharing](https://github.com/user-attachments/assets/54d22fd1-1f2a-4bef-a464-a3832744e6ad)

4. **Configure Windows Registry for Nessus Scanning**
   - Modified the Windows Registry to improve scan accuracy:
     - Navigated to `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`
     - Created a new DWORD named `LocalAccountTokenFilterPolicy` and set its value to `1`.
   - Restarted the VM to apply the changes.

   ![Registry Configuration](https://github.com/user-attachments/assets/2e05d3b5-68d0-49d1-b7c2-7496f1186cef)

5. **Run Credentialed Nessus Scan**
  - I returned to Nessus and reconfigured my initial basic scan, this time adding credentials to enable Nessus to authenticate and scan the machine more effectively. I then ran the scan again.
    <img width="1311" alt="image" src="https://github.com/user-attachments/assets/0015f258-b5f2-45cd-9c0d-56678ba78052">
   ![Credentialed Scan Setup](https://github.com/user-attachments/assets/a918d84b-9206-410c-a57d-617871466b61)

6. **Enable Windows Remote Management (WinRM)**
- Despite running the credentialed scan multiple times, I continued to receive the same results, so I decided to troubleshoot the issue. 
    - I opened Powershell and executed these commands to enable WinRM and configure it for scanning:

   ```powershell
   # Enable PowerShell remoting
   Enable-PSRemoting -Force

   # Allow basic authentication for WinRM
   Set-Item WSMan:\localhost\Service\Auth\Basic -Value $true

   # Allow unencrypted traffic (if SSL is not configured)
   Set-Item WSMan:\localhost\Service\AllowUnencrypted -Value $true

   # Set the WinRM service to start automatically
   Set-Service -Name WinRM -StartupType Automatic

   # Start the WinRM service
   Start-Service -Name WinRM
   ```

   - Configured the firewall to allow WinRM traffic:

   ```powershell
   # Allow WinRM HTTP traffic (port 5985)
   New-NetFirewallRule -Name "WinRM_HTTP" -DisplayName "Allow WinRM over HTTP" -Protocol TCP -LocalPort 5985 -Action Allow

   # Allow WinRM HTTPS traffic (port 5986)
   New-NetFirewallRule -Name "WinRM_HTTPS" -DisplayName "Allow WinRM over HTTPS" -Protocol TCP -LocalPort 5986 -Action Allow
   ```
  - Finally, I tested the WinRM connective to ensure everything was set up correctly:
   ![WinRM Configuration](https://github.com/user-attachments/assets/3e08bfa2-8456-4dec-9a47-0f43daeb5e7c)

Here is a revised version with improved flow:

---

6. **Enable Windows Remote Management (WinRM)**

- After running the credentialed scan multiple times without any change in the results, I decided to troubleshoot the issue further.
  - I opened PowerShell and executed the following commands to enable WinRM and configure it for scanning:

   ```powershell
   # Enable PowerShell remoting
   Enable-PSRemoting -Force

   # Allow basic authentication for WinRM
   Set-Item WSMan:\localhost\Service\Auth\Basic -Value $true

   # Allow unencrypted traffic (if SSL is not configured)
   Set-Item WSMan:\localhost\Service\AllowUnencrypted -Value $true

   # Set the WinRM service to start automatically
   Set-Service -Name WinRM -StartupType Automatic

   # Start the WinRM service
   Start-Service -Name WinRM
   ```

  - I also configured the firewall to allow WinRM traffic:

   ```powershell
   # Allow WinRM HTTP traffic (port 5985)
   New-NetFirewallRule -Name "WinRM_HTTP" -DisplayName "Allow WinRM over HTTP" -Protocol TCP -LocalPort 5985 -Action Allow

   # Allow WinRM HTTPS traffic (port 5986)
   New-NetFirewallRule -Name "WinRM_HTTPS" -DisplayName "Allow WinRM over HTTPS" -Protocol TCP -LocalPort 5986 -Action Allow
   ```

  - Finally, I tested the WinRM connectivity to ensure that everything was configured correctly:

   ![WinRM Configuration](https://github.com/user-attachments/assets/3e08bfa2-8456-4dec-9a47-0f43daeb5e7c)

- After enabling WinRM, the credentialed scan revealed more vulnerabilities than before:

   ![Nessus Scan Results](https://github.com/user-attachments/assets/3e910a5e-42ef-4168-a953-fff7337ffcc1)

7. **Remediation of Identified Vulnerabilities**

- One of the detected vulnerabilities was **SSL Medium Strength Cipher Suites Supported (SWEET32)**. This vulnerability is due to the use of cryptographic algorithms that are considered weak, specifically the 3DES (Triple DES) encryption, which can be exploited by an attacker on the same network to decrypt sensitive data.

- **How to Fix the Vulnerability:**
  - **Disable Weak Ciphers:** The solution to mitigate this vulnerability involves disabling the use of weak ciphers on the affected system. This typically requires modifying the SSL/TLS configuration on your server or application.

   ![SSL/TLS Settings](https://github.com/user-attachments/assets/a84fd576-989f-426a-8639-dcdf77ce2ee0)

- Using PowerShell, I disabled the 3DES and RC4 ciphers by running the following commands:

   ```powershell
   # Disable 3DES cipher
   New-Item -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\Triple DES 168" -Force
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\Triple DES 168" -Name "Enabled" -Value 0 -PropertyType "DWORD" -Force

   # Disable RC4 ciphers
   New-Item -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 128/128" -Force
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 128/128" -Name "Enabled" -Value 0 -PropertyType "DWORD" -Force

   New-Item -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 64/128" -Force
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 64/128" -Name "Enabled" -Value 0 -PropertyType "DWORD" -Force

   New-Item -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 40/128" -Force
   New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\RC4 40/128" -Name "Enabled" -Value 0 -PropertyType "DWORD" -Force
   ```

- After applying these changes, I restarted the system:

   ![Restart System](https://github.com/user-attachments/assets/cd83a0e2-f61d-4c09-ab52-27804768b9b8)

- I ran the Nessus scan again to verify if the high-severity SSL vulnerability had been resolved. The vulnerability was successfully remediated, as it no longer appeared in the scan results:

   ![Remediated Vulnerability](https://github.com/user-attachments/assets/5afee2d1-556f-4f22-a52e-bf38c748a34b)


### Conclusion

This project involved configuring WinRM and performing credentialed scans with Nessus to identify and address vulnerabilities. By enabling WinRM and disabling weak ciphers, I effectively mitigated the **SSL Medium Strength Cipher Suites Supported (SWEET32)** vulnerability. This exercise strengthened my skills in vulnerability management and reinforced the importance of regular system assessments and timely remediation.
